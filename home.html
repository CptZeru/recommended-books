<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Recommendation Book by X</title>
        <link rel="stylesheet" href="home-style.css">
        <script src="https://kit.fontawesome.com/7c02b1753c.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="split left">
            <div class="page-title">
                <h1>Recommended Books <br> By X</h1>
            </div>
            <div class="centered">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Type to search book">
                    <a class="search-btn" href="#">
                        <i class="fa fa-search"></i>
                    </a>
                </div>
                <br>
            </div>
        </div>

        <div class="split right">
            <!-- <div class="page-title" style="transform: translate(10%);">
                <h1>Book List <a class="sort-btn" href="#">SORT <i class="fa fa-sort"></i></a> <br> <hr> </h1>
                <h3>Ini judul buku</p>
            </div> -->
            <table>
                <tr id="booklist-header">
                    <th>
                        <h1>Book List</h1>
                    </th>
                    <th></th>
                    <th>
                        <a class="sort-btn" href=""><h1 class="text-right">SORT <i class="fa fa-sort"></i></h1></a>
                    </th>
                </tr>
                <tr class="table-footer">
                    <td><br><button class="add-btn circle-box" id="add-button"><i class="fa fa-plus"></i> Add</i></button></td>
                    <td></td>
                    <td><div class="pagination-box">
                        <a href=""><</a>
                        <a class="active" href="">1</a>
                        <a href="">2</a>
                        <a href="">></a>
                    </div>    
                    </td>
                </tr>
            </table>
        </div>
        <!-- The Modal -->
        <div id="formModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
                 <!-- Modal header -->
                <div class="modal-header">
                    <span class="close">&times;</span>
                    <h2 class="modal-header-txt">Modal Header</h2>
                </div>
                <div class="modal-body">
                    <form method="POST" id="modal-form" onsubmit="return false;">
                        <label for="bookTitle">Book Title</label>
                        <input type="text" name="title" id="bookTitle" placeholder="Enter Book Title">
                        <label for="bookTitle">Book Category</label>
                        <input type="text" name="category" id="bookCategory" placeholder="Enter Book Category">
                        <label for="bookDesc">Book Description</label>
                        <textarea name="description" id="bookDesc" placeholder="Enter Book Description"></textarea>
                        <br>
                        <button id="bookAddbtn">Add Book</button>
                    </form>
                  </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
        <script>
            $(document).ready(function() {

                // Get the modal
                var modal = document.getElementById("formModal");

                // Get the button that opens the modal
                var addBtn = document.getElementById("add-button");

                // Get the <span> element that closes the modal
                var span = document.getElementsByClassName("close")[0];

                // When the user clicks on the button, open the modal
                addBtn.onclick = function() {
                    modal.style.display = "block";
                    $('.modal-header-txt').
                }

                // When the user clicks on <span> (x), close the modal
                span.onclick = function() {
                    modal.style.display = "none";
                }

                // When the user clicks anywhere outside of the modal, close it
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }

                // Get param api key 
                var a_url = window.location.href;
                console.log(a_url);
                var b_url = new URL(a_url);
                var key = b_url.searchParams.get("key");
                console.log(key);

                // Get the submit btn
                var formBtn = document.getElementById("bookAddbtn");

                //Serialize_form function
                var serialize_form = form => JSON.stringify(
                Array.from(new FormData(form).entries())
                    .reduce((m, [ key, value ]) => Object.assign(m, { [key]: value }), {})
                );

                // User click button, do submit
                $("#modal-form").submit(function(e) {

                e.preventDefault(); // avoid to execute the actual submit of the form.

                // form = $(this).serializeArray();
                // formData = JSON.stringify(form);
                var form = serialize_form(this);
                var add_url = "https://fullstack-book.ariefdfaltah.com/book/create?key="+key;
                console.log(form);
                $.ajax({
                        type: "POST",
                        url: add_url,
                        data: form,
                        dataType: "json",
                        contentType: "application/json",
                        success: function(data)
                        {
                            alert("Succesfully adding new recommendation book"); // show response from the php script.
                        }
                    });
                })

                // get api data list
                $.ajax({
                    url: "https://fullstack-book.ariefdfaltah.com/book/list?key="+key,
                    success: function(data) {
                        for(var i = 0; i<data.meta.data_count; i++){
                            console.log(data.data[i]);
                            var book = '<tr><td><h3>' + data.data[i].title + '</h3></td>' +
                                    '<td><h3 class="text-center">' + data.data[i].category + '</h3></td>' +
                                    '<td><h3 class="text-right"> edit|delete </h3></td></tr>';
                                $('#booklist-header').after(book);
                        }
                    }
                });
            })
        </script>
    </body>
</html>